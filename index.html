<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Despertador</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #121212; color: white; padding: 20px; }
  .card { background: #1e1e1e; padding: 20px; border-radius: 15px; margin: 10px auto; max-width: 300px; }
  input, button { padding: 12px; font-size: 16px; margin: 8px; border-radius: 10px; border: none; width: 90%; }
  button { background: #bb86fc; color: black; font-weight: bold; cursor: pointer; }
  #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; flex-direction: column; justify-content: center; align-items: center; }
  #overlay.show { display: flex; }
  .music-info { font-size: 14px; color: #aaa; margin-top: -5px; margin-bottom: 10px; }
</style>
</head>
<body>

<h1>‚è∞ Despertador Flex</h1>

<div class="card">
  <input type="time" id="alarmTime" value="07:00">
  <br>
  <input type="file" id="musicFile" accept="audio/*" style="display:none" onchange="handleMusicFile(this)">
  <button onclick="document.getElementById('musicFile').click()">üìÇ Selecionar M√∫sica</button>
  <div class="music-info" id="musicName">Nenhuma m√∫sica selecionada</div>
  
  <button style="background: #03dac6;" onclick="setAlarm()">Ativar Alarme</button>
</div>

<div id="overlay" onclick="stopAlarm()"> <h1>üö® HORA DE ACORDAR! üö®</h1>
  <p id="overlayLabel">üéµ</p>
  <button style="background: #ff7597;">PARAR M√öSICA</button>
</div>

<script>
let alarmAudio = new Audio();
let alarmTimeout;

// 1. M√ÅGICA: Carrega o arquivo do celular para a mem√≥ria do navegador
function handleMusicFile(input) {
  const file = input.files[0];
  if (file) {
    alarmAudio.src = URL.createObjectURL(file);
    document.getElementById('musicName').textContent = file.name;
    document.getElementById('overlayLabel').textContent = "üéµ " + file.name;
    // Tenta carregar o √°udio na mem√≥ria
    alarmAudio.load();
  }
}

function setAlarm() {
  const timeInput = document.getElementById('alarmTime').value;
  if (!alarmAudio.src) {
    alert("Por favor, selecione uma m√∫sica primeiro!");
    return;
  }

  const now = new Date();
  const alarm = new Date();
  const [hours, minutes] = timeInput.split(':');
  alarm.setHours(hours);
  alarm.setMinutes(minutes);
  alarm.setSeconds(0);
  
  if (alarm < now) alarm.setDate(alarm.getDate() + 1);
  
  const msUntilAlarm = alarm - now;
  clearTimeout(alarmTimeout);
  
  alarmTimeout = setTimeout(() => {
    triggerAlarm();
  }, msUntilAlarm);
  
  alert(`Alarme definido para ${timeInput}`);
}

function triggerAlarm() {
  document.getElementById('overlay').classList.add('show');
  
  // Tenta tocar com loop
  alarmAudio.loop = true;
  alarmAudio.play().catch(e => {
    console.log("Bloqueado pelo navegador. Toque na tela para liberar.", e);
  });
}

function stopAlarm() {
  alarmAudio.pause();
  alarmAudio.currentTime = 0;
  document.getElementById('overlay').classList.remove('show');
}
</script>

</body>
</html>
