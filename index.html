<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1a0a2e">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Desperte com M√∫sica</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0718;
    --surface: #1a0f2e;
    --card: #221540;
    --accent: #c77dff;
    --gold: #ffd166;
    --rose: #ff6b9d;
    --text: #f0e6ff;
    --muted: #7b68a0;
    --glow: rgba(199,125,255,0.35);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
  }
  .container { max-width:420px; margin:0 auto; padding:20px; }
  
  .header { text-align:center; margin-bottom:28px; }
  .header h1 {
    font-family:'Playfair Display',serif; font-size:26px;
    background:linear-gradient(135deg,var(--accent),var(--gold));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }

  .card {
    background:var(--card); border:1px solid rgba(199,125,255,0.15);
    border-radius:20px; padding:20px; margin-bottom:16px;
    backdrop-filter:blur(10px);
  }
  .card-title {
    font-family:'Playfair Display',serif; font-size:13px; letter-spacing:2px;
    text-transform:uppercase; color:var(--accent); margin-bottom:16px;
  }

  .time-picker { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:16px; }
  .time-scroll {
    background:var(--surface); border:1px solid rgba(199,125,255,0.2); border-radius:12px;
    padding:12px; font-family:'Playfair Display',serif; font-size:36px;
    color:var(--text); width:90px; text-align:center;
  }

  .btn-add {
    width:100%; padding:16px; background:linear-gradient(135deg,var(--accent),var(--rose));
    border:none; border-radius:16px; color:white; font-family:'DM Sans',sans-serif;
    font-size:18px; font-weight:700; cursor:pointer;
  }

  .alarm-overlay {
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:100;
    align-items:center; justify-content:center; flex-direction:column;
  }
  .alarm-overlay.show { display:flex; }
  .btn-stop {
    background:linear-gradient(135deg,var(--gold),var(--rose)); border:none; border-radius:50px;
    padding:16px 36px; color:white; font-size:20px; cursor:pointer;
  }

  /* Estilo do bot√£o de m√∫sica */
  .music-picker {
    width: 100%;
    background: var(--surface);
    border: 1px dashed var(--accent);
    border-radius: 12px;
    padding: 12px;
    color: var(--text);
    text-align: center;
    cursor: pointer;
    margin-bottom: 16px;
  }
</style>
</head>
<body>

<div class="alarm-overlay" id="alarmOverlay">
  <h2 style="font-family:'Playfair Display'; font-size:40px; color:white; margin-bottom:20px">Desperte!</h2>
  <button class="btn-stop" onclick="stopAlarm()">‚èπ Parar</button>
</div>

<div class="container">
  <div class="header">
    <h1>Desperte com M√∫sica</h1>
  </div>

  <div class="card">
    <div class="card-title">‚è∞ Programar Alarme</div>
    <div class="time-picker">
      <input type="number" class="time-scroll" id="alarmHour" min="0" max="23" value="07">
      <span style="font-size:30px; color:var(--muted)">:</span>
      <input type="number" class="time-scroll" id="alarmMin" min="0" max="59" value="00">
    </div>
    
    <div class="card-title">üìÇ Arquivo de M√∫sica</div>
    <input type="file" id="musicFile" accept="audio/*" style="display:none" onchange="handleMusicFile(this)">
    <button class="music-picker" onclick="document.getElementById('musicFile').click()" id="btnPickMusic">
      Selecionar m√∫sica do celular
    </button>
    <div id="musicName" style="font-size:12px; color:var(--muted); text-align:center; margin-bottom:16px; margin-top:-10px">Nenhum arquivo</div>

    <button class="btn-add" onclick="addAlarm()">‚ú¶ Adicionar Alarme</button>
  </div>
</div>

<script>
let alarms = JSON.parse(localStorage.getItem('dcm_alarms') || '[]');
let alarmPlaying = false;
let currentAlarmAudio = new Audio(); // √Åudio compartilhado

function handleMusicFile(input) {
  const file = input.files[0];
  if (file) {
    currentAlarmAudio.src = URL.createObjectURL(file);
    document.getElementById('musicName').textContent = file.name;
    document.getElementById('btnPickMusic').textContent = "Alterar m√∫sica";
    currentAlarmAudio.load();
  }
}

function updateClock() {
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  const s = now.getSeconds();
  
  if (s === 0 && !alarmPlaying) {
    const trigger = alarms.find(a => a.active && a.hour === h && a.min === m);
    if (trigger) triggerAlarm(trigger);
  }
}
setInterval(updateClock, 1000);

function triggerAlarm(alarm) {
  alarmPlaying = true;
  document.getElementById('alarmOverlay').classList.add('show');
  playAlarmSound();
}

function playAlarmSound() {
  if (!currentAlarmAudio.src) {
    alert("Nenhum arquivo de m√∫sica selecionado!");
    stopAlarm();
    return;
  }
  
  currentAlarmAudio.loop = true;
  currentAlarmAudio.play().catch(e => {
    console.error("Bloqueado:", e);
    // Tenta tocar novamente ap√≥s um toque na tela
    document.body.addEventListener('click', () => {
      currentAlarmAudio.play();
    }, { once: true });
  });
}

function stopAlarm() {
  alarmPlaying = false;
  currentAlarmAudio.pause();
  currentAlarmAudio.currentTime = 0;
  document.getElementById('alarmOverlay').classList.remove('show');
}

function saveAlarms() { localStorage.setItem('dcm_alarms', JSON.stringify(alarms)); }

function addAlarm() {
  const h = parseInt(document.getElementById('alarmHour').value);
  const m = parseInt(document.getElementById('alarmMin').value);
  if (!currentAlarmAudio.src) {
    alert("Por favor, selecione uma m√∫sica primeiro!");
    return;
  }
  
  alarms.push({ id: Date.now(), hour: h, min: m, active: true });
  saveAlarms();
  alert("Alarme adicionado!");
}
</script>
</body>
</html>
